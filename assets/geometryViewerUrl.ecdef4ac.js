import{_ as Ee,r as F,A as we,i as de,g as Te,C as De,o as Pe,c as Ie,e as Be,E as Ue,n as $e}from"./app.28a7effe.js";import{s as v,H as xe,d as Ne,f as Ve}from"./geometryViewer.module.a6d7605a.js";const Oe={class:"geometry-viewer"},Fe={__name:"geometryViewerUrl",props:{url:Array},setup(pe){const R=F(null),w=F(null),ue=F(!0),H=pe,ge=()=>Ue.service({lock:!0,text:"\u52A0\u8F7D\u4E2D",fullscreen:!0,background:"rgba(0, 0, 0, 0.7)"});let U,W,z,X,$,j,q,G,J,K,Q,x,D,m,g,_,S;const Y=()=>{U&&U.close(),W=vtk.Rendering.Core.vtkActor,z=vtk.Common.Core.vtkDataArray,X=vtk.Rendering.Core.vtkScalarBarActor,$=vtk.Rendering.Core.vtkColorTransferFunction.vtkColorMaps,j=vtk.Rendering.Core.vtkColorTransferFunction,q=vtk.Rendering.Misc.vtkFullScreenRenderWindow,G=vtk.Rendering.Core.vtkMapper,J=vtk.Common.Core.vtkURLExtract,K=vtk.IO.XML.vtkXMLPolyDataReader,Q=vtk.Interaction.UI.vtkFPSMonitor,x=vtk.Rendering.Core.vtkMapper.ColorMode,D=vtk.Rendering.Core.vtkMapper.ScalarMode,$e(()=>{if(!w.value){let ee=function(e,a){h=!1,Ce(e);const i=[].concat(a.fileURL);console.log(i);const r=document.createElement("div");r.setAttribute("class",v.progress),e.appendChild(r);const l=s=>{if(s.lengthComputable){const u=Math.floor(100*s.loaded/s.total);r.innerHTML=`Loading ${u}%`}else r.innerHTML=Ve(s.loaded)};ye(e);const d=i.length;let p=0;for(;i.length;){const s=i.pop(),u=Array.isArray(n.name)?n.name[i.length]:`Data ${i.length+1}`;xe.fetchBinary(s,{progressCallback:l}).then(c=>{p++,p===d&&e.removeChild(r),be(u,c),fe(_.getActiveCamera())})}},h=!0,f=[0,0,0];const n=J.extractURLParameters();n.background&&(f=n.background.split(",").map(e=>Number(e)));const C=f.length===3&&f.reduce((e,a)=>e+a,0)<1.5?v.dark:v.light,me=n.lut||"erdc_rainbow_bright",ve=n.field||"",fe=e=>{["zoom","pitch","elevation","yaw","azimuth","roll","dolly"].forEach(a=>{n[a]&&e[a](n[a]),g.render()})},Z=e=>{e.preventDefault(),e.stopPropagation()},T=document.createElement("div");T.setAttribute("class",v.rootController);const N=document.createElement("img");N.setAttribute("class",v.button),N.addEventListener("click",()=>{const e=T.style.display!=="none";T.style.display=e?"none":"flex"});const b=Q.newInstance();b.getFpsMonitorContainer().classList.add(v.fpsMonitor),/iPad|iPhone|iPod/.test(window.navigator.platform)&&document.querySelector("body").classList.add("is-ios-device");const Ce=e=>{for(b.setContainer(null);e.firstChild;)e.removeChild(e.firstChild)},ye=e=>{m=q.newInstance({background:f,rootContainer:R.value}),_=m.getRenderer(),g=m.getRenderWindow(),g.getInteractor().setDesiredUpdateRate(15),e.appendChild(T),e.appendChild(N),S=X.newInstance(),_.addActor(S),n.fps&&(Array.isArray(n.fps)&&(b.setMonitorVisibility(...n.fps),n.fps.length===4&&b.setOrientation(n.fps[3])),b.setRenderWindow(g),b.setContainer(e),m.setResizeCallback(b.update))},be=(e,a)=>{const i=document.createElement("select");i.setAttribute("class",C),i.innerHTML=$.rgbPresetNames.map(t=>`<option value="${t}" ${me===t?'selected="selected"':""}>${t}</option>`).join("");const r=document.createElement("select");r.setAttribute("class",C),r.innerHTML=["\u9690\u85CF:0:-1:0","Points:1:0:0","Wireframe:1:1:0","Surface1:2:0","Surface with Edge:1:2:1"].map((t,o)=>`<option value="${o===0?0:1}:${o<4?o-1:2}:${o===4?1:0}">${t}</option>`).join(""),r.value="1:2:0";const l=document.createElement("select");l.setAttribute("class",C);const d=document.createElement("select");d.setAttribute("class",C),d.style.display="none";const p=document.createElement("input");p.setAttribute("class",C),p.setAttribute("type","range"),p.setAttribute("value","100"),p.setAttribute("max","100"),p.setAttribute("min","1");const s=document.createElement("label");s.setAttribute("class",C),s.innerHTML=e;const u=document.createElement("button");u.setAttribute("class",C),u.innerHTML="Start AR";const c=document.createElement("div");c.setAttribute("class",v.control),c.appendChild(s),c.appendChild(r),c.appendChild(i),c.appendChild(l),c.appendChild(d),c.appendChild(p),navigator.xr!==void 0&&navigator.xr.isSessionSupported("immersive-ar")&&m.getApiSpecificRenderWindow().getXrSupported()&&c.appendChild(u),T.appendChild(c);const te=K.newInstance();te.parseAsArrayBuffer(a);const L=j.newInstance(),M=te.getOutputData(0),y=G.newInstance({interpolateScalarsBeforeMapping:!1,useLookupTableScalarRange:!0,lookupTable:L,scalarVisibility:!1}),E=W.newInstance(),ne=M.getPointData().getScalars(),k=[].concat(ne?ne.getRange():[0,1]);let I=z;function V(){const t=$.getPresetByName(i.value);L.applyColorMap(t),L.setMappingRange(k[0],k[1]),L.updateRange(),g.render()}V(),i.addEventListener("change",V);function Ae(t){const[o,A,O]=t.target.value.split(":").map(Number);E.getProperty().set({representation:A,edgeVisibility:O}),E.setVisibility(!!o),g.render()}r.addEventListener("change",Ae);function Se(t){const o=Number(t.target.value)/100;E.getProperty().setOpacity(o),g.render()}p.addEventListener("input",Se);const he=[{value:":",label:"Solid color"}].concat(M.getPointData().getArrays().map(t=>({label:`(p) ${t.getName()}`,value:`PointData:${t.getName()}`})),M.getCellData().getArrays().map(t=>({label:`(c) ${t.getName()}`,value:`CellData:${t.getName()}`})));l.innerHTML=he.map(({label:t,value:o})=>`<option value="${o}" ${ve===o?'selected="selected"':""}>${t}</option>`).join("");function oe(t){const[o,A]=t.target.value.split(":"),O=o==="PointData";let ae=x.DEFAULT,re=D.DEFAULT;const le=o.length>0;if(le){I=M[`get${o}`]().getArrayByName(A);const se=I.getRange();k[0]=se[0],k[1]=se[1],ae=x.MAP_SCALARS,re=o==="PointData"?D.USE_POINT_FIELD_DATA:D.USE_CELL_FIELD_DATA;const ie=I.getNumberOfComponents();if(ie>1){y.getLookupTable()&&y.getLookupTable().setVectorModeToMagnitude(),d.style.display="block";const B=["Magnitude"];for(;B.length<=ie;)B.push(`Component ${B.length}`);d.innerHTML=B.map((ce,Me)=>`<option value="${Me-1}">${ce}</option>`).join("")}else d.style.display="none";S.setAxisLabel(A),S.setVisibility(!0)}else d.style.display="none",S.setVisibility(!1);y.set({colorByArrayName:A,colorMode:ae,interpolateScalarsBeforeMapping:O,scalarMode:re,scalarVisibility:le}),V()}l.addEventListener("change",oe),oe({target:l});function Le(t){if(y.getLookupTable()){const o=y.getLookupTable();if(t.target.value===-1)o.setVectorModeToMagnitude();else{o.setVectorModeToComponent(),o.setVectorComponent(Number(t.target.value));const A=I.getRange(Number(t.target.value));k[0]=A[0],k[1]=A[1],L.setMappingRange(k[0],k[1]),o.updateRange()}g.render()}}d.addEventListener("change",Le);function Re(){u.textContent==="Start AR"?(m.setBackground([...f,0]),m.getApiSpecificRenderWindow().startXR(!0),u.textContent="Exit AR"):(m.setBackground([...f,255]),m.getApiSpecificRenderWindow().stopXR(!0),u.textContent="Start AR")}u.addEventListener("click",Re),E.setMapper(y),y.setInputData(M),_.addActor(E),S.setScalarsToColors(y.getLookupTable());const _e=Ne(g.render,10);L.onModified(_e,-1),_.resetCamera(),g.render(),w.value={actor:E,mapper:y,source:M,lookupTable:L,renderer:_,renderWindow:g,fullScreenRenderWindow:m,scalarBarActor:S},b.update()},ke=e=>{const a=R.value,i=document.querySelector("body"),r=R.value||e||a||i;r!==e&&r.classList.add(v.fullScreen);const l=document.createElement("div");l.innerHTML=`<div class="${v.bigFileDrop}"/><input type="file" multiple accept=".vtp" style="display: none;"/>`,r.appendChild(l);const d=l.querySelector("input");function p(s){Z(s);const u=s.dataTransfer,c=s.target.files||u.files;c.length>0&&(r.removeChild(l),ee(r,{files:c}),ue.value=!1)}d.addEventListener("change",p),l.addEventListener("drop",p),l.addEventListener("click",s=>d.click()),l.addEventListener("dragover",Z)};let P="http://localhost:9999/note/";if(P="https://ajn404.github.io/note/",H.url){let e=[];P+="data/vtp/",H.url.forEach(a=>{e.push(P+a)}),n.fileURL=e,console.log(n.fileURL)}else n.fileURL=`${P}data/diskout-stream-binary-zlib.vtp`;if(console.log(n),n.url||n.fileURL){const a=R.value;a&&a.classList.add(v.fullScreen),ee(a,n)}setTimeout(()=>{h&&ke(R.value)},100)}})};return we(()=>{de&&(window.vtk?Y():(U=ge(),Te(()=>import("https://unpkg.com/vtk.js/Sources/@25.1.0/vtk.js/Sources/"),[]).then(()=>{Y()})))}),De(()=>{if(w.value&&de){const{fullScreenRenderWindow:h,renderWindow:f,renderer:n,scalarBarActor:C}=w.value;n.delete(),f.delete(),C.delete(),window.removeEventListener("resize",h.resize),h.delete(),w.value=null}}),(h,f)=>(Pe(),Ie("div",Oe,[Be("div",{class:"vtk-container",ref_key:"vtkContainerUrl",ref:R},null,512)]))}};var qe=Ee(Fe,[["__scopeId","data-v-52c650f0"],["__file","geometryViewerUrl.vue"]]);export{qe as _};
//# sourceMappingURL=geometryViewerUrl.ecdef4ac.js.map
