import{_ as ge,r as F,A as Pe,i as U,g as Ie,C as xe,o as ve,c as Ce,e as Be,p as Ve,v as $e,a as H,Q as Ne,E as Oe,n as Fe,b as Ue,w as He}from"./app.28a7effe.js";import{_ as We}from"./objectification.dce1857d.js";import{s as g,H as ze,d as Xe,f as je}from"./geometryViewer.module.a6d7605a.js";const qe={class:"geometry-viewer"},Qe={__name:"geometryViewer",setup(ye){const W=v=>{v.preventDefault(),U&&(window.location.href="/note/data/diskout-stream-binary-zlib.vtp")},b=F(null),S=F(null),z=F(!0),_e=()=>Oe.service({lock:!0,text:"\u52A0\u8F7D\u4E2D",fullscreen:!0,background:"rgba(0, 0, 0, 0.7)"});let x,X,j,q,B,Q,G,J,K,Y,Z,V,D,f,m,R,L;const ee=()=>{x&&x.close(),X=vtk.Rendering.Core.vtkActor,j=vtk.Common.Core.vtkDataArray,q=vtk.Rendering.Core.vtkScalarBarActor,B=vtk.Rendering.Core.vtkColorTransferFunction.vtkColorMaps,Q=vtk.Rendering.Core.vtkColorTransferFunction,G=vtk.Rendering.Misc.vtkFullScreenRenderWindow,J=vtk.Rendering.Core.vtkMapper,K=vtk.Common.Core.vtkURLExtract,Y=vtk.IO.XML.vtkXMLPolyDataReader,Z=vtk.Interaction.UI.vtkFPSMonitor,V=vtk.Rendering.Core.vtkMapper.ColorMode,D=vtk.Rendering.Core.vtkMapper.ScalarMode,Fe(()=>{if(!S.value){let he=function(e){const n=new FileReader;n.onload=function(r){oe(e.name,n.result)},n.readAsArrayBuffer(e)},re=function(e,n){if(v=!1,Ae(e),n.files){ae(e);let i=n.files.length;for(;i--;)he(n.files[i]);te(R.getActiveCamera())}else if(n.fileURL){const i=[].concat(n.fileURL),r=document.createElement("div");r.setAttribute("class",g.progress),e.appendChild(r);const l=s=>{if(s.lengthComputable){const u=Math.floor(100*s.loaded/s.total);r.innerHTML=`Loading ${u}%`}else r.innerHTML=je(s.loaded)};ae(e);const d=i.length;let p=0;for(;i.length;){const s=i.pop(),u=Array.isArray(o.name)?o.name[i.length]:`Data ${i.length+1}`;ze.fetchBinary(s,{progressCallback:l}).then(c=>{p++,p===d&&e.removeChild(r),oe(u,c),te(R.getActiveCamera())})}}},v=!0,C=[0,0,0];const o=K.extractURLParameters();o.background&&(C=o.background.split(",").map(e=>Number(e)));const y=C.length===3&&C.reduce((e,n)=>e+n,0)<1.5?g.dark:g.light,be=o.lut||"erdc_rainbow_bright",ke=o.field||"",te=e=>{["zoom","pitch","elevation","yaw","azimuth","roll","dolly"].forEach(n=>{o[n]&&e[n](o[n]),m.render()})},ne=e=>{e.preventDefault(),e.stopPropagation()},T=document.createElement("div");T.setAttribute("class",g.rootController);const $=document.createElement("img");$.setAttribute("class",g.button),$.addEventListener("click",()=>{const e=T.style.display!=="none";T.style.display=e?"none":"flex"});const k=Z.newInstance();k.getFpsMonitorContainer().classList.add(g.fpsMonitor),/iPad|iPhone|iPod/.test(window.navigator.platform)&&document.querySelector("body").classList.add("is-ios-device");const Ae=e=>{for(k.setContainer(null);e.firstChild;)e.removeChild(e.firstChild)},ae=e=>{f=G.newInstance({background:C,rootContainer:b.value}),R=f.getRenderer(),m=f.getRenderWindow(),m.getInteractor().setDesiredUpdateRate(15),e.appendChild(T),e.appendChild($),L=q.newInstance(),R.addActor(L),o.fps&&(Array.isArray(o.fps)&&(k.setMonitorVisibility(...o.fps),o.fps.length===4&&k.setOrientation(o.fps[3])),k.setRenderWindow(m),k.setContainer(e),f.setResizeCallback(k.update))},oe=(e,n)=>{const i=document.createElement("select");i.setAttribute("class",y),i.innerHTML=B.rgbPresetNames.map(t=>`<option value="${t}" ${be===t?'selected="selected"':""}>${t}</option>`).join("");const r=document.createElement("select");r.setAttribute("class",y),r.innerHTML=["\u9690\u85CF","Points","Wireframe","Surface","Surface with Edge"].map((t,a)=>`<option value="${a===0?0:1}:${a<4?a-1:2}:${a===4?1:0}">${t}</option>`).join(""),r.value="1:2:0";const l=document.createElement("select");l.setAttribute("class",y);const d=document.createElement("select");d.setAttribute("class",y),d.style.display="none";const p=document.createElement("input");p.setAttribute("class",y),p.setAttribute("type","range"),p.setAttribute("value","100"),p.setAttribute("max","100"),p.setAttribute("min","1");const s=document.createElement("label");s.setAttribute("class",y),s.innerHTML=e;const u=document.createElement("button");u.setAttribute("class",y),u.innerHTML="Start AR";const c=document.createElement("div");c.setAttribute("class",g.control),c.appendChild(s),c.appendChild(r),c.appendChild(i),c.appendChild(l),c.appendChild(d),c.appendChild(p),navigator.xr!==void 0&&navigator.xr.isSessionSupported("immersive-ar")&&f.getApiSpecificRenderWindow().getXrSupported()&&c.appendChild(u),T.appendChild(c);const ie=Y.newInstance();ie.parseAsArrayBuffer(n);const w=Q.newInstance(),M=ie.getOutputData(0),_=J.newInstance({interpolateScalarsBeforeMapping:!1,useLookupTableScalarRange:!0,lookupTable:w,scalarVisibility:!1}),E=X.newInstance(),le=M.getPointData().getScalars(),A=[].concat(le?le.getRange():[0,1]);let P=j;function N(){const t=B.getPresetByName(i.value);w.applyColorMap(t),w.setMappingRange(A[0],A[1]),w.updateRange(),m.render()}N(),i.addEventListener("change",N);function Re(t){const[a,h,O]=t.target.value.split(":").map(Number);E.getProperty().set({representation:h,edgeVisibility:O}),E.setVisibility(!!a),m.render()}r.addEventListener("change",Re);function Le(t){const a=Number(t.target.value)/100;E.getProperty().setOpacity(a),m.render()}p.addEventListener("input",Le);const we=[{value:":",label:"Solid color"}].concat(M.getPointData().getArrays().map(t=>({label:`(p) ${t.getName()}`,value:`PointData:${t.getName()}`})),M.getCellData().getArrays().map(t=>({label:`(c) ${t.getName()}`,value:`CellData:${t.getName()}`})));l.innerHTML=we.map(({label:t,value:a})=>`<option value="${a}" ${ke===a?'selected="selected"':""}>${t}</option>`).join("");function se(t){const[a,h]=t.target.value.split(":"),O=a==="PointData";let ce=V.DEFAULT,de=D.DEFAULT;const pe=a.length>0;if(pe){P=M[`get${a}`]().getArrayByName(h);const ue=P.getRange();A[0]=ue[0],A[1]=ue[1],ce=V.MAP_SCALARS,de=a==="PointData"?D.USE_POINT_FIELD_DATA:D.USE_CELL_FIELD_DATA;const me=P.getNumberOfComponents();if(me>1){_.getLookupTable()&&_.getLookupTable().setVectorModeToMagnitude(),d.style.display="block";const I=["Magnitude"];for(;I.length<=me;)I.push(`Component ${I.length}`);d.innerHTML=I.map((fe,De)=>`<option value="${De-1}">${fe}</option>`).join("")}else d.style.display="none";L.setAxisLabel(h),L.setVisibility(!0)}else d.style.display="none",L.setVisibility(!1);_.set({colorByArrayName:h,colorMode:ce,interpolateScalarsBeforeMapping:O,scalarMode:de,scalarVisibility:pe}),N()}l.addEventListener("change",se),se({target:l});function Me(t){if(_.getLookupTable()){const a=_.getLookupTable();if(t.target.value===-1)a.setVectorModeToMagnitude();else{a.setVectorModeToComponent(),a.setVectorComponent(Number(t.target.value));const h=P.getRange(Number(t.target.value));A[0]=h[0],A[1]=h[1],w.setMappingRange(A[0],A[1]),a.updateRange()}m.render()}}d.addEventListener("change",Me);function Ee(){u.textContent==="Start AR"?(f.setBackground([...C,0]),f.getApiSpecificRenderWindow().startXR(!0),u.textContent="Exit AR"):(f.setBackground([...C,255]),f.getApiSpecificRenderWindow().stopXR(!0),u.textContent="Start AR")}u.addEventListener("click",Ee),E.setMapper(_),_.setInputData(M),R.addActor(E),L.setScalarsToColors(_.getLookupTable());const Te=Xe(m.render,10);w.onModified(Te,-1),R.resetCamera(),m.render(),S.value={actor:E,mapper:_,source:M,lookupTable:w,renderer:R,renderWindow:m,fullScreenRenderWindow:f,scalarBarActor:L},k.update()},Se=e=>{const n=b.value,i=document.querySelector("body"),r=b.value||e||n||i;r!==e&&r.classList.add(g.fullScreen);const l=document.createElement("div");l.innerHTML=`<div class="${g.bigFileDrop}"/><input type="file" multiple accept=".vtp" style="display: none;"/>`,r.appendChild(l);const d=l.querySelector("input");function p(s){ne(s);const u=s.dataTransfer,c=s.target.files||u.files;c.length>0&&(r.removeChild(l),re(r,{files:c}),z.value=!1)}d.addEventListener("change",p),l.addEventListener("drop",p),l.addEventListener("click",s=>d.click()),l.addEventListener("dragover",ne)};if(o.url||o.fileURL){const n=b.value;n&&n.classList.add(g.fullScreen),re(n,o)}setTimeout(()=>{v&&Se(b.value)},100)}})};return Pe(()=>{U&&(window.vtk?ee():(x=_e(),Ie(()=>import("https://unpkg.com/vtk.js/Sources/@25.1.0/vtk.js/Sources/"),[]).then(()=>{ee()})))}),xe(()=>{if(S.value&&U){const{fullScreenRenderWindow:v,renderWindow:C,renderer:o,scalarBarActor:y}=S.value;o.delete(),C.delete(),y.delete(),window.removeEventListener("resize",v.resize),v.delete(),S.value=null}}),(v,C)=>{const o=We;return ve(),Ce("div",qe,[Be("div",{class:"vtk-container",ref_key:"vtkContainer",ref:b},null,512),Ve(H(o,{class:"fixed",ref:"txtRef",text:"\u70B9\u51FB\u56FE\u7247\u4E0A\u4F20vtp\u6587\u4EF6,\u70B9\u51FB\u672C\u6587\u5B57\u4E0B\u8F7D\u793A\u4F8B\u6587\u4EF6",onClick:Ne(W,["prevent"])},null,512),[[$e,z.value]])])}}};var Ge=ge(Qe,[["__scopeId","data-v-a2e112d0"],["__file","geometryViewer.vue"]]);const Je={};function Ke(ye,W){const b=Ge,S=Ue("ClientOnly");return ve(),Ce("div",null,[H(S,null,{default:He(()=>[H(b)]),_:1})])}var ot=ge(Je,[["render",Ke],["__file","geometryViewer.html.vue"]]);export{ot as default};
//# sourceMappingURL=geometryViewer.html.c66c780f.js.map
